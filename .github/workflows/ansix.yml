name: AnsiX

on:
  workflow_dispatch:
    inputs:
      runs_on:
        required: false
        type: string
        default: "ubuntu-latest"
      dart_sdk:
        required: false
        type: string
        default: "2.19.6"
      analyze_directories:
        required: false
        type: string
        default: "lib test"
      line_length:
        required: false
        type: number
        default: 120
      skip_tests:
        required: false
        type: boolean
        default: false
      concurrency:
        required: false
        type: number
        default: 4
      coverage:
        type: boolean
        required: false
        default: false
      codecov:
        type: boolean
        required: false
        default: false
      publish:
        type: boolean
        required: false
        default: false
      pana_threshold:
        type: number
        required: false
        default: 0
  workflow_call:
    inputs:
      runs_on:
        required: false
        type: string
        default: "ubuntu-latest"
      dart_sdk:
        required: false
        type: string
        default: "2.19.6"
      analyze_directories:
        required: false
        type: string
        default: "lib test"
      line_length:
        required: false
        type: number
        default: 120
      skip_tests:
        required: false
        type: boolean
        default: false
      concurrency:
        required: false
        type: number
        default: 4
      coverage:
        type: boolean
        required: false
        default: false
      codecov:
        type: boolean
        required: false
        default: false
      publish:
        type: boolean
        required: false
        default: false
      pana_threshold:
        type: number
        required: false
        default: 0

jobs:
  ansix:
    defaults:
      run:
        working-directory: .
    runs-on: ${{inputs.runs_on}}
    steps:
      - uses: actions/checkout@v3
      - uses: nikosportolos/dart_package@v0.0.3
        with:
          working_directory: .
          dart_sdk: ${{ inputs.dart_sdk }}
          analyze_directories: ${{ inputs.analyze_directories }}
          line_length: ${{ inputs.line_length }}
          skip_tests: ${{ inputs.skip_tests }}
          concurrency: ${{ inputs.concurrency }}
          coverage: ${{ inputs.coverage }}
          codecov: ${{ inputs.codecov }}
          codecov_token: ${{ secrets.CODECOV_TOKEN }}
          publish: ${{ inputs.publish }}
          pubdev_token: ${{ secrets.PUBDEV_TOKEN }}
